package pages

import (
	"fmt"
	"oliverbutler/components"
	"oliverbutler/lib"
	"oliverbutler/lib/users"

	g "github.com/maragudk/gomponents"

	. "github.com/maragudk/gomponents/html"
	"golang.org/x/net/context"
)

func PhotoPage(ctx context.Context, app *lib.App, user *users.UserContext, id string) g.Node {
	photo, err := app.Photos.GetPhoto(ctx, id)
	if err != nil {
		return components.Page(Div(
			components.NavBar("/photos/"+photo.ID, app, user),
		))
	}

	return components.Page(Div(
		Div(Class("max-w-6xl mx-auto px-4 py-4"),
			Div(Class("flex flex-row justify-between items-center mb-4"),
				H3(Class("text-lg"), g.Text(photo.Name)),
				A(Href("/photos"),
					Class("hover:text-gray-900 transition-colors"),
					g.Text("‚Üê Back to photos"),
				),
			),
			Div(Class("flex items-center justify-center gap-8 mt-4 text-gray-600 text-sm"),
				// Aperture
				g.If(photo.Aperature != "",
					Div(Class("flex items-center gap-2"),
						g.Raw(`<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10.1797 8C9.6274 8 9.17969 8.44772 9.17969 9C9.17969 9.55228 9.6274 10 10.1797 10V8ZM14.4298 3.63683C14.7059 3.15854 14.542 2.54695 14.0637 2.27081C13.5855 1.99467 12.9739 2.15854 12.6977 2.63683L14.4298 3.63683ZM7.58057 11.5C7.30443 11.9783 7.4683 12.5899 7.9466 12.866C8.42489 13.1422 9.03648 12.9783 9.31262 12.5L7.58057 11.5ZM9.31495 15.5C9.59109 15.9783 10.2027 16.1422 10.681 15.866C11.1593 15.5899 11.3231 14.9783 11.047 14.5L9.31495 15.5ZM5.97404 5.71337C5.6979 5.23508 5.08631 5.0712 4.60802 5.34735C4.12973 5.62349 3.96585 6.23508 4.24199 6.71337L5.97404 5.71337ZM16.3126 12.5C16.5888 12.0217 16.4249 11.4101 15.9466 11.134C15.4683 10.8578 14.8567 11.0217 14.5806 11.5L16.3126 12.5ZM9.47273 20.347C9.19659 20.8253 9.36047 21.4369 9.83876 21.7131C10.3171 21.9892 10.9286 21.8253 11.2048 21.347L9.47273 20.347ZM17.9659 18.3595C18.242 18.8377 18.8536 19.0016 19.3319 18.7255C19.8102 18.4493 19.9741 17.8377 19.6979 17.3595L17.9659 18.3595ZM14.5829 8.5C14.3068 8.02171 13.6952 7.85783 13.2169 8.13397C12.7386 8.41012 12.5747 9.02171 12.8509 9.5L14.5829 8.5ZM3.49981 14C2.94753 14 2.49981 14.4477 2.49981 15C2.49981 15.5523 2.94753 16 3.49981 16V14ZM20.4844 8H10.1797V10H20.4844V8ZM12.6977 2.63683L7.58057 11.5L9.31262 12.5L14.4298 3.63683L12.6977 2.63683ZM11.047 14.5L5.97404 5.71337L4.24199 6.71337L9.31495 15.5L11.047 14.5ZM14.5806 11.5L9.47273 20.347L11.2048 21.347L16.3126 12.5L14.5806 11.5ZM19.6979 17.3595L14.5829 8.5L12.8509 9.5L17.9659 18.3595L19.6979 17.3595ZM13.6886 14H3.49981V16H13.6886V14ZM20 12C20 16.4183 16.4183 20 12 20V22C17.5228 22 22 17.5228 22 12H20ZM12 20C7.58172 20 4 16.4183 4 12H2C2 17.5228 6.47715 22 12 22V20ZM4 12C4 7.58172 7.58172 4 12 4V2C6.47715 2 2 6.47715 2 12H4ZM12 4C16.4183 4 20 7.58172 20 12H22C22 6.47715 17.5228 2 12 2V4Z" fill="currentColor"/>
</svg>`),
						g.Text(photo.Aperature),
					),
				),
				// Shutter Speed
				g.If(photo.ShutterSpeed != "",
					Div(Class("flex items-center gap-2"),
						g.Raw(`<svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.06152 12C5.55362 8.05369 8.92001 5 12.9996 5C17.4179 5 20.9996 8.58172 20.9996 13C20.9996 17.4183 17.4179 21 12.9996 21H8M13 13V9M11 3H15M3 15H8M5 18H10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`),
						g.Text(photo.ShutterSpeed),
					),
				),
				// ISO
				g.If(photo.ISO != "",
					Div(Class("flex items-center gap-2"),
						g.Raw(`<svg width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M17 5H7C4.79086 5 3 6.79086 3 9V15C3 17.2091 4.79086 19 7 19H17C19.2091 19 21 17.2091 21 15V9C21 6.79086 19.2091 5 17 5Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M13.6079 11.9894C13.6021 11.5753 13.2616 11.2443 12.8474 11.2501C12.4333 11.2559 12.1022 11.5964 12.1081 12.0106L13.6079 11.9894ZM15.429 14.5L15.4331 13.75C15.4282 13.75 15.4234 13.75 15.4186 13.7501L15.429 14.5ZM16.163 14.4L15.9617 13.6775L15.9585 13.6785L16.163 14.4ZM18.75 12.0057C18.7531 11.5915 18.4198 11.2532 18.0056 11.25C17.5914 11.2469 17.2531 11.5802 17.25 11.9944L18.75 12.0057ZM17.2501 12.0106C17.2559 12.4248 17.5964 12.7558 18.0106 12.7499C18.4247 12.7441 18.7558 12.4036 18.7499 11.9894L17.2501 12.0106ZM15.429 9.50002L15.4249 10.25C15.4298 10.25 15.4346 10.25 15.4394 10.2499L15.429 9.50002ZM14.695 9.60002L14.896 10.3226L14.8995 10.3216L14.695 9.60002ZM12.107 11.9943C12.1039 12.4085 12.4371 12.7468 12.8513 12.75C13.2655 12.7532 13.6038 12.4199 13.607 12.0057L12.107 11.9943ZM6.75 9.50002C6.75 9.08581 6.41421 8.75002 6 8.75002C5.58579 8.75002 5.25 9.08581 5.25 9.50002H6.75ZM5.25 14.5C5.25 14.9142 5.58579 15.25 6 15.25C6.41421 15.25 6.75 14.9142 6.75 14.5H5.25ZM11.15 10.25C11.5642 10.25 11.9 9.91424 11.9 9.50002C11.9 9.08581 11.5642 8.75002 11.15 8.75002V10.25ZM9.5 9.50002L9.47062 10.2494C9.48041 10.2498 9.4902 10.25 9.5 10.25V9.50002ZM8.56585 9.84514L9.0754 10.3955L8.56585 9.84514ZM8.15 10.75L7.40053 10.7218C7.39982 10.7406 7.39982 10.7595 7.40053 10.7783L8.15 10.75ZM8.56585 11.6549L9.0754 11.1046V11.1046L8.56585 11.6549ZM9.5 12V11.25C9.4902 11.25 9.48041 11.2502 9.47062 11.2506L9.5 12ZM9.8 12V12.75C9.8098 12.75 9.81959 12.7498 9.82938 12.7494L9.8 12ZM10.7342 12.3451L10.2246 12.8955L10.7342 12.3451ZM11.15 13.25L11.8995 13.2783C11.9002 13.2595 11.9002 13.2406 11.8995 13.2218L11.15 13.25ZM10.7342 14.1549L10.2246 13.6046L10.7342 14.1549ZM9.8 14.5L9.82938 13.7506C9.81959 13.7502 9.8098 13.75 9.8 13.75V14.5ZM8.15 13.75C7.73579 13.75 7.4 14.0858 7.4 14.5C7.4 14.9142 7.73579 15.25 8.15 15.25V13.75ZM12.1081 12.0106C12.1337 13.825 13.625 15.2752 15.4394 15.2499L15.4186 13.7501C14.4324 13.7638 13.6218 12.9756 13.6079 11.9894L12.1081 12.0106ZM15.4249 15.25C15.7436 15.2517 16.0609 15.2085 16.3675 15.1216L15.9585 13.6785C15.7876 13.7269 15.6107 13.751 15.4331 13.75L15.4249 15.25ZM16.3643 15.1225C17.7658 14.732 18.739 13.4605 18.75 12.0057L17.25 11.9944C17.2441 12.78 16.7185 13.4667 15.9617 13.6775L16.3643 15.1225ZM18.7499 11.9894C18.7243 10.1751 17.233 8.72487 15.4186 8.75009L15.4394 10.2499C16.4256 10.2362 17.2362 11.0245 17.2501 12.0106L18.7499 11.9894ZM15.4331 8.75003C15.1144 8.74831 14.7971 8.79154 14.4905 8.87845L14.8995 10.3216C15.0704 10.2731 15.2473 10.2491 15.4249 10.25L15.4331 8.75003ZM14.494 8.87746C13.092 9.26744 12.1181 10.5391 12.107 11.9943L13.607 12.0057C13.613 11.2199 14.1389 10.5332 14.896 10.3226L14.494 8.87746ZM5.25 9.50002V14.5H6.75V9.50002H5.25ZM11.15 8.75002H9.5V10.25H11.15V8.75002ZM9.52938 8.7506C8.98558 8.72928 8.45562 8.92507 8.05629 9.29482L9.0754 10.3955C9.18254 10.2963 9.32472 10.2437 9.47062 10.2494L9.52938 8.7506ZM8.05629 9.29482C7.65696 9.66456 7.42105 10.1779 7.40053 10.7218L8.89947 10.7783C8.90497 10.6324 8.96827 10.4947 9.0754 10.3955L8.05629 9.29482ZM7.40053 10.7783C7.42105 11.3221 7.65696 11.8355 8.05629 12.2052L9.0754 11.1046C8.96827 11.0054 8.90497 10.8677 8.89947 10.7218L7.40053 10.7783ZM8.05629 12.2052C8.45562 12.575 8.98558 12.7708 9.52938 12.7494L9.47062 11.2506C9.32472 11.2563 9.18254 11.2038 9.0754 11.1046L8.05629 12.2052ZM9.5 12.75H9.8V11.25H9.5V12.75ZM9.82938 12.7494C9.97528 12.7437 10.1175 12.7963 10.2246 12.8955L11.2437 11.7948C10.8444 11.4251 10.3144 11.2293 9.77062 11.2506L9.82938 12.7494ZM10.2246 12.8955C10.3317 12.9947 10.395 13.1324 10.4005 13.2783L11.8995 13.2218C11.879 12.6779 11.643 12.1646 11.2437 11.7948L10.2246 12.8955ZM10.4005 13.2218C10.395 13.3677 10.3317 13.5054 10.2246 13.6046L11.2437 14.7052C11.643 14.3355 11.879 13.8221 11.8995 13.2783L10.4005 13.2218ZM10.2246 13.6046C10.1175 13.7038 9.97528 13.7563 9.82938 13.7506L9.77062 15.2494C10.3144 15.2708 10.8444 15.075 11.2437 14.7052L10.2246 13.6046ZM9.8 13.75H8.15V15.25H9.8V13.75Z" fill="currentColor"/>
</svg>`),
						g.Text(photo.ISO),
					),
				),
				// Focal Length
				g.If(photo.FocalLength != "",
					Div(Class("flex items-center gap-2"),
						g.Raw(`<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M6 4h12v16H6z"/>
							<path d="M6 8h12"/>
							<path d="M6 16h12"/>
							<circle cx="12" cy="12" r="2"/>
						</svg>`),
						g.Text(fmt.Sprintf("%s (%s)", photo.FocalLength, photo.Lens)),
					),
				),
			),
			A(
				Href("/api/photos/"+photo.ID+"?quality=original"),
				Class("block rounded-lg cursor-zoom-in"),
				Img(
					Src("/api/photos/"+photo.ID+"?quality=large"),
					g.Attr("blur-hash", photo.BlurHash),
					g.Attr("data-width", fmt.Sprint(photo.Width)),
					g.Attr("data-height", fmt.Sprint(photo.Height)),
					Class("max-h-[85vh] w-auto mx-auto rounded-lg hover:opacity-95 transition-opacity"),
					Alt(photo.Name),
				),
			),
		),
	))
}
